
# 🎯 PWM Decoding - 202200867 변하연

본 프로젝트는 RC 수신기(R9DS)의 3개 채널을 사용하여 아래 기능을 제어하는 시스템을 구현한 것입니다.

- ✅ LED ON/OFF 제어 (CH9)
- ✅ LED 밝기 제어 (CH2)
- ✅ RGB LED 색상 제어 (CH3)

> 🔗 **시연 영상** : https://youtu.be/K3GcpnnoMX0?si=CwxZeCydMa4uAOfW




---

## 🖼️ 하드웨어 연결 구성도

| 연결 목적        | Arduino 핀 | RC 수신기 채널 | 설명 |
|------------------|------------|----------------|------|
| 밝기 제어 입력   | 2번        | CH2            | 밝기 입력 (PWM 변환용) |
| 색상 제어 입력   | 3번        | CH3            | 색상 위치 값 입력 |
| ON/OFF 입력      | 4번        | CH9            | 스위치 판단 (기준값 1500μs) |
| LED ON/OFF 출력  | 5번        | -              | 일반 디지털 출력 |
| 밝기 출력        | 6번        | -              | PWM 기반 LED 출력 |
| RGB RED          | 9번        | -              | RGB 제어용 (PWM) |
| RGB GREEN        | 8번        | -              | RGB 제어용 (PWM) |
| RGB BLUE         | 7번        | -              | RGB 제어용 (PWM) |

> ※ 핀 배치는 아두이노 UNO 기준이며, 보드에 따라 차이가 있을 수 있습니다.

---

## 🔧 시스템 구성 설명

### 1. 입력 신호 처리

- 각 채널은 **펄스 폭(PWM: 1000~2000μs)** 신호를 보내며,
- Arduino는 이를 `micros()`를 이용해 측정합니다.
- 인터럽트 방식으로 모든 채널의 입력 신호를 **실시간**으로 감지합니다.

### 2. 채널별 동작 방식

#### 🔌 CH9 - ON/OFF 제어

- 수신한 펄스 폭이 **1500μs보다 낮을 경우 ON**, 그렇지 않으면 OFF
- 디지털 핀 5번에 연결된 LED로 구현됨

#### 💡 CH2 - 밝기 제어

- 수신한 펄스 폭을 `map()` 함수를 통해 **PWM 범위(255~0)**로 매핑
- 아날로그 출력 핀(6번)을 통해 LED 밝기 조절

#### 🌈 CH3 - RGB 색상 변화

- 펄스 폭을 기반으로 색상 위치(0~765)를 계산
- 내부 함수 `setRGB(pos, r, g, b)`를 통해 빨강-노랑-파랑 순서로 자연스럽게 전환

---

## 🧠 코드 구성 요약 (main.cpp)

### 🔁 루프 구조

```cpp
void loop() {
    runner.execute();  // TaskScheduler가 주기적으로 updateLEDs() 호출
}

```
## 🧠 구현 방식 요약

- **인터럽트 기반 신호 측정**: 각 채널은 인터럽트를 통해 펄스폭 측정
- **TaskScheduler 사용**: LED 업데이트 및 디버그 메시지 출력 주기를 제어
- **색상 계산 로직**: `setRGB()` 함수로 입력 값을 RGB 색상으로 매핑
- **온오프 판단 기준**: 중앙값(1500μs)과 임계값(200μs)을 기준으로 판단

---

## ▶️ 실행 결과 

- RC 조종기를 조작하면 LED가 아래와 같이 반응합니다:
  1. **CH9 조작 시**: LED 전원이 켜졌다 꺼짐
  2. **CH2 조작 시**: LED 밝기 조절 가능
  3. **CH3 조작 시**: LED 색상이 부드럽게 변화



---

## 👩‍💻 개발 정보

- 작성자: 고광채, 변하연 
- 개발 보드: Arduino UNO
- 수신기: R9DS
- 사용 언어: C++ (Arduino)
- 라이브러리:
  - `TaskScheduler.h`
  - `PinChangeInterrupt.h`   
  
   
  
  
*라즈베리파이가 아닌 아두이노로 작동시켰기에 platformio에서 
upload_port = /dev/ttyUSB0 해당 코드 주석처리 하였습니다.


